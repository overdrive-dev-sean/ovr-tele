global:
  scrape_interval: 15s
  scrape_timeout: 10s
  external_labels:
    deployment_id: "__DEPLOYMENT_ID__"
    node_id: "__NODE_ID__"

scrape_configs:
  - job_name: node_exporter
    scrape_interval: 5s
    scrape_timeout: 4s
    file_sd_configs:
      - files:
          - /etc/ovr/targets.yml
    relabel_configs:
      - source_labels: [job]
        regex: node_exporter
        action: keep

  - job_name: event_service
    scrape_interval: 15s
    scrape_timeout: 10s
    metrics_path: /metrics
    file_sd_configs:
      - files:
          - /etc/ovr/targets.yml
    relabel_configs:
      - source_labels: [job]
        regex: event_service
        action: keep

  - job_name: vm_federate_acuvim
    scrape_interval: 10s
    metrics_path: /federate
    params:
      match[]:
        - '{__name__=~"acuvim_.*"}'
    static_configs:
      - targets:
          - "victoria-metrics:8428"

  # Federate victron metrics from VM (written by Telegraf) for stream aggregation
  - job_name: vm_federate_victron
    scrape_interval: 10s
    metrics_path: /federate
    params:
      match[]:
        - '{__name__=~"victron_.*"}'
    static_configs:
      - targets:
          - "victoria-metrics:8428"
