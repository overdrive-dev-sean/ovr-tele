# OVR Edge Internal MQTT Broker
# This broker is for internal container communication only (no host ports exposed)

# Listen on localhost only (host network mode, don't expose to LAN)
listener 1883 127.0.0.1

# Allow anonymous connections (internal use only - not exposed to host)
allow_anonymous true

# Persistence for retained messages
persistence true
persistence_location /mosquitto/data/

# Logging
log_dest stdout
log_type error
log_type warning
log_type notice
log_type information

# Connection settings
max_keepalive 120

# ============================================
# Cloud Bridge Configuration
# Bidirectional sync with cloud MQTT broker:
#   - OUT: ovr/<node_id>/realtime → cloud (fleet map, event sync)
#   - OUT: ovr/<node_id>/reports → cloud (report upload)
#   - IN:  ovr/registry/# ← cloud (event list, fleet config)
#   - IN:  ovr/events/# ← cloud (event end broadcast, alignment)
# ============================================
connection cloud-bridge
address 5.78.73.219:1883
remote_username ovr-bridge
remote_password devpassword123
topic ovr/# out 1
topic ovr/registry/# in 1
topic ovr/events/# in 1
bridge_protocol_version mqttv311
cleansession true
start_type automatic
notifications true
try_private false
log_type all
