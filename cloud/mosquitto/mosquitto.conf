# OVR Cloud MQTT Broker
# Receives bridged data from edge nodes, serves WebSocket to fleet map UI

# =============================================================================
# MQTT Listener (for edge bridges)
# =============================================================================
listener 1883

# Require authentication for MQTT connections (edge bridges)
# Password file format: username:password_hash (use mosquitto_passwd to generate)
password_file /mosquitto/config/passwd
allow_anonymous false

# =============================================================================
# WebSocket Listener (for browser clients)
# =============================================================================
listener 9001
protocol websockets

# Allow anonymous WebSocket connections (behind Cloudflare Access)
# This listener only allows subscribe, not publish (enforced by ACL)
allow_anonymous true

# =============================================================================
# ACL (Access Control)
# =============================================================================
acl_file /mosquitto/config/acl

# =============================================================================
# Persistence
# =============================================================================
persistence true
persistence_location /mosquitto/data/

# =============================================================================
# Logging
# =============================================================================
log_dest stdout
log_type error
log_type warning
log_type notice
# log_type information  # Uncomment for debugging

# =============================================================================
# Connection settings
# =============================================================================
max_keepalive 120
